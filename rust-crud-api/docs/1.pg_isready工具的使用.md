# pg_isready 工具的使用
`pg_isready` 是 PostgreSQL 数据库系统提供的一个命令行工具，用于检查 PostgreSQL 服务器是否正在运行并且可以接受连接，现在我来详细解释这行代码：

```bash
if ! pg_isready -h $DB_HOST -p $DB_PORT > /dev/null 2>&1; then
```

## `pg_isready` 命令详解：

**参数说明**：
- `-h $DB_HOST`：指定数据库主机地址（这里是 localhost）
- `-p $DB_PORT`：指定数据库端口（这里是 5432）
- `> /dev/null 2>&1`：将标准输出和错误输出都重定向到 /dev/null（即不显示输出）

**逻辑解释**：
- `!` 表示逻辑非，即如果 `pg_isready` 命令失败（返回非零退出码），条件为真
- 如果 PostgreSQL 服务器无法连接，`pg_isready` 会返回非零退出码
- 当条件为真时，脚本会执行 then 块中的代码，提示用户 PostgreSQL 服务未运行并退出

**实际作用**：
这行代码是一个**健康检查**，确保在执行后续数据库操作之前，PostgreSQL 服务器是可用的。如果服务器不可用，脚本会：
1. 显示错误消息
2. 提供启动 PostgreSQL 的命令提示
3. 退出脚本（`exit 1`）

这是一个很好的防御性编程实践，避免在数据库服务未启动的情况下执行后续操作而导致错误。
        