# Rust CRUD API é¡¹ç›®

ä¸€ä¸ªä½¿ç”¨ Rust å¼€å‘çš„ç”¨æˆ·ç®¡ç† Web APIï¼Œæ”¯æŒå®Œæ•´çš„ CRUDï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰åŠŸèƒ½ã€‚

## ğŸ›  æŠ€æœ¯æ ˆ

- **Web æ¡†æ¶**: Actix-web 4.4
- **æ•°æ®åº“æ“ä½œ**: SQLx 0.7 (æ”¯æŒ PostgreSQL)
- **å¼‚æ­¥è¿è¡Œæ—¶**: Tokio
- **åºåˆ—åŒ–**: Serde
- **å¯†ç åŠ å¯†**: bcrypt
- **æ—¥å¿—**: env_logger

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

- âœ… ç”¨æˆ·æ³¨å†Œï¼ˆå¸¦å¯†ç åŠ å¯†ï¼‰
- âœ… ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢ï¼ˆæŒ‰ ID æˆ–ç”¨æˆ·åï¼‰
- âœ… ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹
- âœ… ç”¨æˆ·åˆ é™¤
- âœ… è·å–æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨
- âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿ä½ çš„ç³»ç»Ÿå·²å®‰è£…ï¼š
- Rust (æœ€æ–°ç¨³å®šç‰ˆ)
- PostgreSQL (æœ¬åœ°è¿è¡Œ)
- jq (ç”¨äºæµ‹è¯•è„šæœ¬ï¼Œå¯é€‰)

### 2. æ•°æ®åº“è®¾ç½®

```bash
# è¿æ¥åˆ° PostgreSQL
psql -U postgres

# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE rust_crud_db;

# åˆ›å»ºç”¨æˆ· (å¯é€‰ï¼Œæˆ–ä½¿ç”¨ç°æœ‰ç”¨æˆ·)
CREATE USER your_username WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE rust_crud_db TO your_username;
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼š
```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œè®¾ç½®ä½ çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼š
```env
DATABASE_URL=postgresql://your_username:your_password@localhost:5432/rust_crud_db
SERVER_HOST=127.0.0.1
SERVER_PORT=8080
```

### 4. æ„å»ºå’Œè¿è¡Œ

```bash
# æ„å»ºé¡¹ç›®
cargo build

# è¿è¡Œé¡¹ç›®
cargo run
```

æœåŠ¡å™¨å°†åœ¨ `http://127.0.0.1:8080` å¯åŠ¨ã€‚

## ğŸ“š API æ–‡æ¡£

### åŸºç¡€ URL
```
http://127.0.0.1:8080
```

### ç«¯ç‚¹åˆ—è¡¨

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| POST | `/api/users` | ç”¨æˆ·æ³¨å†Œ |
| GET | `/api/users` | è·å–æ‰€æœ‰ç”¨æˆ· |
| GET | `/api/users/{id}` | æ ¹æ® ID è·å–ç”¨æˆ· |
| GET | `/api/users/username/{username}` | æ ¹æ®ç”¨æˆ·åè·å–ç”¨æˆ· |
| PUT | `/api/users/{id}` | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ |
| DELETE | `/api/users/{id}` | åˆ é™¤ç”¨æˆ· |
| GET | `/health` | å¥åº·æ£€æŸ¥ |

### è¯·æ±‚ç¤ºä¾‹

#### 1. ç”¨æˆ·æ³¨å†Œ
```bash
curl -X POST http://127.0.0.1:8080/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "username": "johndoe",
    "email": "john@example.com",
    "password": "password123",
    "full_name": "John Doe"
  }'
```

#### 2. è·å–ç”¨æˆ·ä¿¡æ¯
```bash
curl -X GET http://127.0.0.1:8080/api/users/{user_id}
```

#### 3. æ›´æ–°ç”¨æˆ·ä¿¡æ¯
```bash
curl -X PUT http://127.0.0.1:8080/api/users/{user_id} \
  -H "Content-Type: application/json" \
  -d '{
    "email": "newemail@example.com",
    "full_name": "New Name"
  }'
```

#### 4. åˆ é™¤ç”¨æˆ·
```bash
curl -X DELETE http://127.0.0.1:8080/api/users/{user_id}
```

### å“åº”æ ¼å¼

æ‰€æœ‰ API å“åº”éƒ½éµå¾ªç»Ÿä¸€æ ¼å¼ï¼š

```json
{
  "success": true,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "id": "uuid",
    "username": "johndoe",
    "email": "john@example.com",
    "full_name": "John Doe",
    "created_at": "2024-01-01T00:00:00Z",
    "updated_at": "2024-01-01T00:00:00Z"
  }
}
```

é”™è¯¯å“åº”ï¼š
```json
{
  "success": false,
  "message": "é”™è¯¯æè¿°",
  "data": null
}
```

## ğŸ§ª æµ‹è¯•

é¡¹ç›®åŒ…å«ä¸€ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼š

```bash
# ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼Œç„¶åæ‰§è¡Œ
./test_api.sh
```

è¿™ä¸ªè„šæœ¬ä¼šæµ‹è¯•æ‰€æœ‰çš„ CRUD æ“ä½œã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
rust-crud-api/
â”œâ”€â”€ Cargo.toml                    # é¡¹ç›®é…ç½®å’Œä¾èµ–
â”œâ”€â”€ README.md                     # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ ARCHITECTURE.md               # æ¶æ„æ–‡æ¡£
â”œâ”€â”€ .env.example                  # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ test_api.sh                   # API æµ‹è¯•è„šæœ¬
â”œâ”€â”€ migrations/                   # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”‚   â””â”€â”€ 001_create_users_table.sql
â”œâ”€â”€ src/                          # æºä»£ç 
â”‚   â”œâ”€â”€ lib.rs                   # åº“æ ¹æ¨¡å—ï¼Œå®šä¹‰å…¬å…±æ¥å£
â”‚   â”œâ”€â”€ main.rs                  # åº”ç”¨ç¨‹åºå…¥å£ç‚¹
â”‚   â”œâ”€â”€ config/                  # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ mod.rs              # é…ç½®ç»“æ„å’Œç¯å¢ƒå˜é‡å¤„ç†
â”‚   â”œâ”€â”€ database/                # æ•°æ®åº“å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs              # æ•°æ®åº“æ¨¡å—æ ¹
â”‚   â”‚   â”œâ”€â”€ connection.rs       # æ•°æ®åº“è¿æ¥æ± ç®¡ç†
â”‚   â”‚   â””â”€â”€ migrations.rs       # æ•°æ®åº“è¿ç§»å¤„ç†
â”‚   â”œâ”€â”€ models/                  # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ mod.rs              # æ¨¡å‹æ¨¡å—æ ¹
â”‚   â”‚   â”œâ”€â”€ user.rs             # ç”¨æˆ·ç›¸å…³æ•°æ®ç»“æ„
â”‚   â”‚   â””â”€â”€ response.rs         # API å“åº”ç»“æ„
â”‚   â”œâ”€â”€ services/                # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs              # æœåŠ¡æ¨¡å—æ ¹
â”‚   â”‚   â””â”€â”€ user.rs             # ç”¨æˆ·ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ handlers/                # HTTP è¯·æ±‚å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ mod.rs              # å¤„ç†å™¨æ¨¡å—æ ¹
â”‚   â”‚   â”œâ”€â”€ user.rs             # ç”¨æˆ·ç›¸å…³ API å¤„ç†å™¨
â”‚   â”‚   â””â”€â”€ health.rs           # å¥åº·æ£€æŸ¥å¤„ç†å™¨
â”‚   â”œâ”€â”€ routes/                  # è·¯ç”±é…ç½®
â”‚   â”‚   â””â”€â”€ mod.rs              # è·¯ç”±å®šä¹‰å’Œé…ç½®
â”‚   â”œâ”€â”€ middleware/              # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ mod.rs              # ä¸­é—´ä»¶æ¨¡å—æ ¹
â”‚   â”‚   â””â”€â”€ logging.rs          # è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ mod.rs              # å·¥å…·æ¨¡å—æ ¹
â”‚   â”‚   â”œâ”€â”€ validation.rs       # æ•°æ®éªŒè¯å·¥å…·
â”‚   â”‚   â””â”€â”€ password.rs         # å¯†ç å¤„ç†å·¥å…·
â”‚   â””â”€â”€ errors/                  # é”™è¯¯å¤„ç†
â”‚       â””â”€â”€ mod.rs              # ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œå“åº”
â””â”€â”€ tests/                       # æµ‹è¯•æ–‡ä»¶
    â”œâ”€â”€ integration_tests.rs     # é›†æˆæµ‹è¯•
    â””â”€â”€ common/                  # æµ‹è¯•è¾…åŠ©æ¨¡å—
        â””â”€â”€ mod.rs              # å…±äº«æµ‹è¯•å·¥å…·
```

## ğŸ— æ¶æ„è®¾è®¡

é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–çš„åˆ†å±‚æ¶æ„ï¼š

- **config/**: åº”ç”¨ç¨‹åºé…ç½®ç®¡ç†
- **database/**: æ•°æ®åº“è¿æ¥å’Œè¿ç§»ç®¡ç†
- **models/**: æ•°æ®æ¨¡å‹å’ŒéªŒè¯é€»è¾‘
- **services/**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- **handlers/**: HTTP è¯·æ±‚å¤„ç†
- **routes/**: è·¯ç”±é…ç½®å’Œç»„ç»‡
- **middleware/**: ä¸­é—´ä»¶ï¼ˆæ—¥å¿—ã€è®¤è¯ç­‰ï¼‰
- **utils/**: é€šç”¨å·¥å…·å‡½æ•°
- **errors/**: ç»Ÿä¸€é”™è¯¯å¤„ç†

è¯¦ç»†æ¶æ„è¯´æ˜è¯·æŸ¥çœ‹ [ARCHITECTURE.md](./ARCHITECTURE.md)

## ğŸ”§ å¼€å‘è¯´æ˜

### æ•°æ®åº“è¡¨ç»“æ„

ç”¨æˆ·è¡¨å­—æ®µï¼š
- `id`: UUID ä¸»é”®
- `username`: ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
- `email`: é‚®ç®±ï¼ˆå”¯ä¸€ï¼‰
- `password_hash`: åŠ å¯†åçš„å¯†ç 
- `full_name`: å…¨å
- `created_at`: åˆ›å»ºæ—¶é—´
- `updated_at`: æ›´æ–°æ—¶é—´ï¼ˆè‡ªåŠ¨æ›´æ–°ï¼‰

### å®‰å…¨ç‰¹æ€§

- å¯†ç ä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨
- API å“åº”ä¸­ä¸åŒ…å«å¯†ç ä¿¡æ¯
- è¾“å…¥éªŒè¯å’Œé”™è¯¯å¤„ç†
- æ•°æ®åº“çº¦æŸç¡®ä¿æ•°æ®å®Œæ•´æ€§

## ğŸ§ª æµ‹è¯•

é¡¹ç›®åŒ…å«å¤šå±‚æµ‹è¯•ï¼š

### å•å…ƒæµ‹è¯•
```bash
cargo test
```

### é›†æˆæµ‹è¯•
```bash
cargo test --test integration_tests
```

### API æµ‹è¯•
```bash
# ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
./test_api.sh
```

## ğŸš§ åç»­æ‰©å±•

å¯ä»¥è€ƒè™‘æ·»åŠ çš„åŠŸèƒ½ï¼š
- JWT èº«ä»½è®¤è¯
- API é™æµå’Œé¢‘æ¬¡æ§åˆ¶
- è¾“å…¥éªŒè¯ä¸­é—´ä»¶
- ç¼“å­˜å±‚ï¼ˆRedisï¼‰
- Docker å®¹å™¨åŒ–
- API æ–‡æ¡£ç”Ÿæˆ (Swagger/OpenAPI)
- ç›‘æ§å’ŒæŒ‡æ ‡æ”¶é›†
- æ—¥å¿—èšåˆå’Œåˆ†æ

## ğŸ“„ è®¸å¯è¯

MIT License